<mxfile host="Electron" agent="Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/28.0.6 Chrome/138.0.7204.100 Electron/37.2.3 Safari/537.36" version="28.0.6" pages="3">
  <diagram name="Требования" id="YBXd4IOUc2_DfyveqcFs">
    <mxGraphModel dx="777" dy="482" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="nKMEFq8FLVlC6uLXKZMd-1" value="&lt;h1 style=&quot;margin-top: 0px;&quot;&gt;FR&lt;/h1&gt;&lt;p&gt;1:1 чат&lt;/p&gt;&lt;p&gt;групповойчат&lt;/p&gt;&lt;p&gt;текст \ картинки \ видео&lt;/p&gt;&lt;p&gt;чтение уведомлений&lt;/p&gt;&lt;p&gt;последний просмотр&lt;/p&gt;" style="text;html=1;whiteSpace=wrap;overflow=hidden;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="480" y="120" width="180" height="180" as="geometry" />
        </mxCell>
        <mxCell id="nKMEFq8FLVlC6uLXKZMd-2" value="&lt;h1 style=&quot;margin-top: 0px;&quot;&gt;NFR&lt;/h1&gt;&lt;p&gt;Low Latency&lt;/p&gt;&lt;p&gt;High Availability&lt;/p&gt;&lt;p&gt;No Lag&lt;/p&gt;&lt;p&gt;Scale&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;2 млн пользователей&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;16 млн MAU&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;65 млн сообщений&lt;br&gt;&lt;/p&gt;" style="text;html=1;whiteSpace=wrap;overflow=hidden;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="180" y="120" width="180" height="280" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="PxCmlFHkpQky8orRqkz_" name="HL">
    <mxGraphModel dx="777" dy="1651" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="Kd1nXyAYjb_mbeEn8PsD-4" value="LB" style="shape=module;align=left;spacingLeft=20;align=center;verticalAlign=top;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="240" y="200" width="100" height="430" as="geometry" />
        </mxCell>
        <mxCell id="Kd1nXyAYjb_mbeEn8PsD-6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0.5;exitDx=0;exitDy=0;exitPerimeter=0;startArrow=classic;startFill=1;" edge="1" parent="1" source="Kd1nXyAYjb_mbeEn8PsD-1" target="Kd1nXyAYjb_mbeEn8PsD-5">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Kd1nXyAYjb_mbeEn8PsD-1" value="U1" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;" vertex="1" parent="1">
          <mxGeometry x="120" y="180" width="30" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Kd1nXyAYjb_mbeEn8PsD-9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0.5;exitDx=0;exitDy=0;exitPerimeter=0;startArrow=classic;startFill=1;" edge="1" parent="1" source="Kd1nXyAYjb_mbeEn8PsD-2" target="Kd1nXyAYjb_mbeEn8PsD-7">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Kd1nXyAYjb_mbeEn8PsD-2" value="U2" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;" vertex="1" parent="1">
          <mxGeometry x="120" y="360" width="30" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Kd1nXyAYjb_mbeEn8PsD-3" value="U3" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;" vertex="1" parent="1">
          <mxGeometry x="120" y="493" width="30" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Kd1nXyAYjb_mbeEn8PsD-11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;startArrow=classic;startFill=1;" edge="1" parent="1" source="Kd1nXyAYjb_mbeEn8PsD-5" target="Kd1nXyAYjb_mbeEn8PsD-7">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Kd1nXyAYjb_mbeEn8PsD-5" value="WebSocket handler 1" style="shape=module;align=left;spacingLeft=20;align=center;verticalAlign=top;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="400" y="225" width="100" height="50" as="geometry" />
        </mxCell>
        <mxCell id="Kd1nXyAYjb_mbeEn8PsD-12" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;startArrow=classic;startFill=1;" edge="1" parent="1" source="Kd1nXyAYjb_mbeEn8PsD-7" target="Kd1nXyAYjb_mbeEn8PsD-8">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Kd1nXyAYjb_mbeEn8PsD-7" value="WebSocket handler 2" style="shape=module;align=left;spacingLeft=20;align=center;verticalAlign=top;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="400" y="365" width="100" height="50" as="geometry" />
        </mxCell>
        <mxCell id="Kd1nXyAYjb_mbeEn8PsD-8" value="WebSocket handler 3" style="shape=module;align=left;spacingLeft=20;align=center;verticalAlign=top;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="400" y="498" width="100" height="50" as="geometry" />
        </mxCell>
        <mxCell id="Kd1nXyAYjb_mbeEn8PsD-20" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;startArrow=classic;startFill=1;" edge="1" parent="1" source="Kd1nXyAYjb_mbeEn8PsD-13" target="Kd1nXyAYjb_mbeEn8PsD-16">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Kd1nXyAYjb_mbeEn8PsD-13" value="LB" style="shape=module;align=left;spacingLeft=20;align=center;verticalAlign=top;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="550" y="200" width="100" height="430" as="geometry" />
        </mxCell>
        <mxCell id="Kd1nXyAYjb_mbeEn8PsD-14" value="U1:U2:m1" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="105" y="260" width="60" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Kd1nXyAYjb_mbeEn8PsD-15" value="&lt;h1 style=&quot;margin-top: 0px;&quot;&gt;WebSocket handler&lt;/h1&gt;&lt;p&gt;Каждая машина имеет 65000 портов, значит может обрабатывать 65000 активных соединений - 5000 на другие нужды&lt;/p&gt;&lt;p&gt;Эти сервисы географически распределены и пользователи подключаются к серверу, который ближе к ним, чтобы имет минимальную задержку&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;text-align: center;&quot;&gt;Пользователь отправлет U1:U2:m1&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: transparent;&quot;&gt;WebSocket handler получает и параллельно:&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;span style=&quot;text-align: center;&quot;&gt;разговаривает с WebSocket Manager - говорит что пользователь U2 находится на&amp;nbsp;&lt;/span&gt;WebSocket handler&amp;nbsp;2&lt;/li&gt;&lt;li&gt;разговаривает с MessageService - сохраняет сообщение&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;/p&gt;&lt;p style=&quot;&quot;&gt;и затем обращается к&amp;nbsp;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;WebSocket handler&amp;nbsp;2 и говорит, что для U2 есть сообщение&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;&quot;&gt;WebSocket handler&amp;nbsp;2 будучи соединенным с U2 отправляет ему сообщение&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;&quot;&gt;Если не соеденен с U2 говорит, что он оффлайн.&lt;/p&gt;&lt;p style=&quot;&quot;&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;Может случится 3 вещи:&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;&quot;&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;1) может быть пользователь не использует активно приложение, но сообщение доставлено&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;&quot;&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;2) девайс отправляет сообщение, что сообщение получил и оно прочитано -&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;WebSocket handler 1 уходит подтверждение&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;&quot;&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;Каждая машина может отлавливать две вещи:&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;&quot;&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;1) список пользователейподключенных к ней. Если пользователи в одном хэндлере, то WebSocketManager вызываться не будет&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;&quot;&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;2) на короткий интервал времени 10-30 сек данные о соединениях пользователей кэшируются и также не требуется обращения к&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;WebSocketManager&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;&quot;&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/p&gt;" style="text;html=1;whiteSpace=wrap;overflow=hidden;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="180" y="640" width="380" height="590" as="geometry" />
        </mxCell>
        <mxCell id="Kd1nXyAYjb_mbeEn8PsD-23" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;startArrow=classic;startFill=1;" edge="1" parent="1" source="Kd1nXyAYjb_mbeEn8PsD-16" target="Kd1nXyAYjb_mbeEn8PsD-22">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Kd1nXyAYjb_mbeEn8PsD-16" value="WebSocket Manager" style="shape=module;align=left;spacingLeft=20;align=center;verticalAlign=top;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="700" y="390" width="100" height="50" as="geometry" />
        </mxCell>
        <mxCell id="Kd1nXyAYjb_mbeEn8PsD-17" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.099;entryY=0.115;entryDx=0;entryDy=0;entryPerimeter=0;startArrow=classic;startFill=1;" edge="1" parent="1" source="Kd1nXyAYjb_mbeEn8PsD-5" target="Kd1nXyAYjb_mbeEn8PsD-13">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Kd1nXyAYjb_mbeEn8PsD-18" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.099;entryY=0.444;entryDx=0;entryDy=0;entryPerimeter=0;startArrow=classic;startFill=1;" edge="1" parent="1" source="Kd1nXyAYjb_mbeEn8PsD-7" target="Kd1nXyAYjb_mbeEn8PsD-13">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Kd1nXyAYjb_mbeEn8PsD-19" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.75;entryDx=10;entryDy=0;entryPerimeter=0;startArrow=classic;startFill=1;" edge="1" parent="1" source="Kd1nXyAYjb_mbeEn8PsD-8" target="Kd1nXyAYjb_mbeEn8PsD-13">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Kd1nXyAYjb_mbeEn8PsD-21" value="&lt;h1 style=&quot;margin-top: 0px;&quot;&gt;WebSocket Manager&lt;/h1&gt;&lt;p&gt;Это репозиторий фактов, что конкретное устройство сейчас подключилось&amp;nbsp;&lt;/p&gt;&lt;p&gt;Он сделан на базе Redis&lt;/p&gt;" style="text;html=1;whiteSpace=wrap;overflow=hidden;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="633.5" y="760" width="233" height="200" as="geometry" />
        </mxCell>
        <mxCell id="Kd1nXyAYjb_mbeEn8PsD-22" value="Redis" style="shape=module;align=left;spacingLeft=20;align=center;verticalAlign=top;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="880" y="390" width="100" height="50" as="geometry" />
        </mxCell>
        <mxCell id="Kd1nXyAYjb_mbeEn8PsD-26" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.75;entryDx=0;entryDy=0;startArrow=classic;startFill=1;" edge="1" parent="1" source="Kd1nXyAYjb_mbeEn8PsD-25" target="Kd1nXyAYjb_mbeEn8PsD-13">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Kd1nXyAYjb_mbeEn8PsD-29" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;startArrow=classic;startFill=1;" edge="1" parent="1" source="Kd1nXyAYjb_mbeEn8PsD-25" target="Kd1nXyAYjb_mbeEn8PsD-28">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Kd1nXyAYjb_mbeEn8PsD-25" value="&lt;span style=&quot;text-align: left;&quot;&gt;Message&lt;/span&gt;&lt;div&gt;&lt;span style=&quot;text-align: left;&quot;&gt;Service&lt;/span&gt;&lt;/div&gt;" style="shape=module;align=left;spacingLeft=20;align=center;verticalAlign=top;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="700" y="497" width="100" height="50" as="geometry" />
        </mxCell>
        <mxCell id="Kd1nXyAYjb_mbeEn8PsD-27" value="&lt;h1 style=&quot;margin-top: 0px;&quot;&gt;Message&lt;/h1&gt;&lt;h1 style=&quot;margin-top: 0px;&quot;&gt;&lt;span style=&quot;background-color: transparent;&quot;&gt;Service&lt;/span&gt;&lt;/h1&gt;&lt;p&gt;Репозиторий всехсообщений в системе&lt;/p&gt;&lt;p&gt;getMessage(messageId)&lt;/p&gt;&lt;p&gt;getMessage(другие Id)&lt;/p&gt;&lt;p&gt;различные фильтры&lt;/p&gt;&lt;p&gt;если мы хотим получить непрочитанные сообщения данным пользователем, то обращаемся к этому сервису&lt;/p&gt;&lt;p&gt;Есть два подхода:&lt;/p&gt;&lt;p&gt;как в Facebook - хранить все сообщения&amp;nbsp;&lt;/p&gt;&lt;p&gt;как в Watsapp - хранить только недоставленные сообщения&amp;nbsp;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;(в это случае касандра не очень хороший выбор, потому что надо будет из нее удалять сообщения)&lt;/span&gt;&lt;/p&gt;" style="text;html=1;whiteSpace=wrap;overflow=hidden;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="900" y="760" width="380" height="350" as="geometry" />
        </mxCell>
        <mxCell id="Kd1nXyAYjb_mbeEn8PsD-28" value="Cassandra" style="shape=module;align=left;spacingLeft=20;align=center;verticalAlign=top;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="880" y="497" width="100" height="50" as="geometry" />
        </mxCell>
        <mxCell id="Kd1nXyAYjb_mbeEn8PsD-40" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0;exitDx=0;exitDy=15;exitPerimeter=0;" edge="1" parent="1" source="Kd1nXyAYjb_mbeEn8PsD-30" target="Kd1nXyAYjb_mbeEn8PsD-33">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Kd1nXyAYjb_mbeEn8PsD-43" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.75;exitDx=0;exitDy=0;" edge="1" parent="1" source="Kd1nXyAYjb_mbeEn8PsD-30" target="Kd1nXyAYjb_mbeEn8PsD-42">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Kd1nXyAYjb_mbeEn8PsD-30" value="Kafka" style="shape=module;align=left;spacingLeft=20;align=center;verticalAlign=top;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="1070" y="275" width="100" height="195" as="geometry" />
        </mxCell>
        <mxCell id="Kd1nXyAYjb_mbeEn8PsD-31" value="U1:U3:m2" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="105" y="290" width="60" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Kd1nXyAYjb_mbeEn8PsD-32" value="&lt;h1 style=&quot;margin-top: 0px;&quot;&gt;U1:U3:m2&lt;/h1&gt;&lt;p&gt;Пусть U3 не подключен ни к одной из машин, с ним нет коммуникации.&lt;/p&gt;&lt;p&gt;WebSocket handler 1 получает ответ что U3 не в сети.&lt;/p&gt;&lt;p&gt;Затем U3 подключается и запрашивает MessageService о непрочитанных сообщениях и получает их. Затем соединяется с U1 и теперь могут коммуницировать друг с другом.&lt;/p&gt;&lt;p&gt;Здесь могут быть потенциальные риски:&lt;/p&gt;&lt;p&gt;польователь может отправить тебе сообщение. но ты видишь драмматично&amp;nbsp;жертва обвиняет жертву в интернете - параллельные звонки.&lt;/p&gt;&lt;p&gt;Можно этот рассинхрон убрать последовательностью действий,но не рекомендуется, снизится частота обмена.&lt;/p&gt;&lt;p&gt;Лучше сохранить данные в БД на девайсе. И как появится интернет - отправить их.&lt;/p&gt;" style="text;html=1;whiteSpace=wrap;overflow=hidden;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="180" y="1240" width="380" height="360" as="geometry" />
        </mxCell>
        <mxCell id="Kd1nXyAYjb_mbeEn8PsD-35" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.75;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="Kd1nXyAYjb_mbeEn8PsD-33" target="Kd1nXyAYjb_mbeEn8PsD-7">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Kd1nXyAYjb_mbeEn8PsD-36" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0;exitDx=0;exitDy=15;exitPerimeter=0;entryX=0.75;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="1" source="Kd1nXyAYjb_mbeEn8PsD-33" target="Kd1nXyAYjb_mbeEn8PsD-5">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Kd1nXyAYjb_mbeEn8PsD-39" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;startArrow=classic;startFill=1;" edge="1" parent="1" source="Kd1nXyAYjb_mbeEn8PsD-33" target="Kd1nXyAYjb_mbeEn8PsD-16">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Kd1nXyAYjb_mbeEn8PsD-33" value="Group Message Handler" style="shape=module;align=left;spacingLeft=20;align=center;verticalAlign=top;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="700" y="290" width="100" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Kd1nXyAYjb_mbeEn8PsD-38" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;startArrow=classic;startFill=1;" edge="1" parent="1" source="Kd1nXyAYjb_mbeEn8PsD-37" target="Kd1nXyAYjb_mbeEn8PsD-33">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Kd1nXyAYjb_mbeEn8PsD-37" value="Group Service" style="shape=module;align=left;spacingLeft=20;align=center;verticalAlign=top;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="700" y="200" width="100" height="50" as="geometry" />
        </mxCell>
        <mxCell id="Kd1nXyAYjb_mbeEn8PsD-41" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.75;entryDx=10;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="Kd1nXyAYjb_mbeEn8PsD-25" target="Kd1nXyAYjb_mbeEn8PsD-30">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="750" y="460" />
              <mxPoint x="1020" y="460" />
              <mxPoint x="1020" y="421" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Kd1nXyAYjb_mbeEn8PsD-42" value="Hadoop" style="shape=module;align=left;spacingLeft=20;align=center;verticalAlign=top;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="1160" y="497" width="100" height="50" as="geometry" />
        </mxCell>
        <mxCell id="Kd1nXyAYjb_mbeEn8PsD-44" value="&lt;span style=&quot;text-align: left;&quot;&gt;Asset&lt;/span&gt;&lt;div&gt;&lt;span style=&quot;text-align: left;&quot;&gt;Service&lt;/span&gt;&lt;/div&gt;" style="shape=module;align=left;spacingLeft=20;align=center;verticalAlign=top;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="700" y="581" width="100" height="50" as="geometry" />
        </mxCell>
        <mxCell id="Kd1nXyAYjb_mbeEn8PsD-45" value="S3" style="shape=module;align=left;spacingLeft=20;align=center;verticalAlign=top;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="880" y="570" width="100" height="50" as="geometry" />
        </mxCell>
        <mxCell id="Kd1nXyAYjb_mbeEn8PsD-46" value="CDN" style="shape=module;align=left;spacingLeft=20;align=center;verticalAlign=top;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="880" y="640" width="100" height="50" as="geometry" />
        </mxCell>
        <mxCell id="Kd1nXyAYjb_mbeEn8PsD-47" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0;exitDx=0;exitDy=15;exitPerimeter=0;entryX=0.975;entryY=0.921;entryDx=0;entryDy=0;entryPerimeter=0;endArrow=none;endFill=0;startArrow=classic;startFill=1;" edge="1" parent="1" source="Kd1nXyAYjb_mbeEn8PsD-44" target="Kd1nXyAYjb_mbeEn8PsD-13">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Kd1nXyAYjb_mbeEn8PsD-48" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.25;exitDx=0;exitDy=0;entryX=0;entryY=0;entryDx=0;entryDy=15;entryPerimeter=0;startArrow=classic;startFill=1;" edge="1" parent="1" source="Kd1nXyAYjb_mbeEn8PsD-44" target="Kd1nXyAYjb_mbeEn8PsD-45">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Kd1nXyAYjb_mbeEn8PsD-49" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.75;exitDx=0;exitDy=0;entryX=0;entryY=0;entryDx=0;entryDy=15;entryPerimeter=0;startArrow=classic;startFill=1;" edge="1" parent="1" source="Kd1nXyAYjb_mbeEn8PsD-44" target="Kd1nXyAYjb_mbeEn8PsD-46">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Kd1nXyAYjb_mbeEn8PsD-50" value="&lt;h1 style=&quot;margin-top: 0px;&quot;&gt;Group Message Handler&lt;/h1&gt;&lt;p&gt;Пользователь отправляет сообщение на группу&amp;nbsp;&lt;span style=&quot;text-align: center; background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;U1:G1:m3&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;text-align: center; background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;Сообщение передается&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;text-align: center; background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;Group Message Handler и сохраняется в&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;Message&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;Service&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;В кафке есть топик группы&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;text-align: center;&quot;&gt;Запрашивает Group Service, чтобы получить всех пользователей в группе&lt;/span&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;text-align: center;&quot;&gt;Затем идет в&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;text-align: center; background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;WebSocket Manager получить машины пользователей группы и затем отправляет сообщения на каждый&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;text-align: center; background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;WebSocket handler&lt;/span&gt;&lt;/p&gt;" style="text;html=1;whiteSpace=wrap;overflow=hidden;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="690" y="-120" width="340" height="260" as="geometry" />
        </mxCell>
        <mxCell id="Kd1nXyAYjb_mbeEn8PsD-52" value="U1:G1:m3" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="105" y="310" width="60" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Kd1nXyAYjb_mbeEn8PsD-53" value="&lt;h1 style=&quot;margin-top: 0px;&quot;&gt;AssetService&lt;/h1&gt;&lt;p&gt;Когда пользователь пытается загрузить контент - первым делом происходит сжатие, после получения контент разархивируется.&lt;/p&gt;&lt;p&gt;U3:U2:&amp;lt;image&amp;gt;&lt;/p&gt;&lt;p&gt;хэндлер пересылает на AssetService через LB&lt;/p&gt;&lt;p&gt;Asset&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;Service сохраняет image в S3 и затем решает, отправить ли картинку в CDN - пользователи часто шлют одну картинку многим, поэтому ее лучше отправить в CDN. Вычисляем хэш и если он уже есть в кэше отправляем ссылку на CDN&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;и затем сообщение стандартным оразом отправляется получателю&lt;/span&gt;&lt;/p&gt;" style="text;html=1;whiteSpace=wrap;overflow=hidden;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="1320" y="760" width="320" height="320" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="4Ja_F9jh2Ol2HUkBIFl2" name="UserApp">
    <mxGraphModel dx="938" dy="581" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="HTI_eXZl_OFtCIEmgwi2-1" value="UserApp" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="90" y="95" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="HTI_eXZl_OFtCIEmgwi2-2" value="LB" style="shape=module;align=left;spacingLeft=20;align=center;verticalAlign=top;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="300" y="20" width="100" height="420" as="geometry" />
        </mxCell>
        <mxCell id="HTI_eXZl_OFtCIEmgwi2-3" value="User Service" style="shape=module;align=left;spacingLeft=20;align=center;verticalAlign=top;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="490" y="40" width="100" height="50" as="geometry" />
        </mxCell>
        <mxCell id="HTI_eXZl_OFtCIEmgwi2-4" value="Group Service" style="shape=module;align=left;spacingLeft=20;align=center;verticalAlign=top;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="490" y="160" width="100" height="50" as="geometry" />
        </mxCell>
        <mxCell id="HTI_eXZl_OFtCIEmgwi2-20" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;startArrow=classic;startFill=1;" edge="1" parent="1" source="HTI_eXZl_OFtCIEmgwi2-5" target="HTI_eXZl_OFtCIEmgwi2-19">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="HTI_eXZl_OFtCIEmgwi2-5" value="Analytics Service" style="shape=module;align=left;spacingLeft=20;align=center;verticalAlign=top;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="490" y="260" width="100" height="50" as="geometry" />
        </mxCell>
        <mxCell id="HTI_eXZl_OFtCIEmgwi2-23" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.75;exitDx=0;exitDy=0;startArrow=classic;startFill=1;" edge="1" parent="1" source="HTI_eXZl_OFtCIEmgwi2-6" target="HTI_eXZl_OFtCIEmgwi2-22">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="HTI_eXZl_OFtCIEmgwi2-6" value="Last Seen Service" style="shape=module;align=left;spacingLeft=20;align=center;verticalAlign=top;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="490" y="360" width="100" height="50" as="geometry" />
        </mxCell>
        <mxCell id="HTI_eXZl_OFtCIEmgwi2-7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=10;entryDy=0;entryPerimeter=0;startArrow=classic;startFill=1;" edge="1" parent="1" source="HTI_eXZl_OFtCIEmgwi2-1" target="HTI_eXZl_OFtCIEmgwi2-2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="HTI_eXZl_OFtCIEmgwi2-8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0;exitDx=0;exitDy=15;exitPerimeter=0;entryX=0.991;entryY=0.084;entryDx=0;entryDy=0;entryPerimeter=0;startArrow=classic;startFill=1;" edge="1" parent="1" source="HTI_eXZl_OFtCIEmgwi2-3" target="HTI_eXZl_OFtCIEmgwi2-2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="HTI_eXZl_OFtCIEmgwi2-9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0;exitDx=0;exitDy=15;exitPerimeter=0;entryX=0.987;entryY=0.332;entryDx=0;entryDy=0;entryPerimeter=0;startArrow=classic;startFill=1;" edge="1" parent="1" source="HTI_eXZl_OFtCIEmgwi2-4" target="HTI_eXZl_OFtCIEmgwi2-2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="HTI_eXZl_OFtCIEmgwi2-10" value="User DB&lt;div&gt;PostgreSQL&lt;/div&gt;" style="shape=module;align=left;spacingLeft=20;align=center;verticalAlign=top;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="670" y="50" width="100" height="50" as="geometry" />
        </mxCell>
        <mxCell id="HTI_eXZl_OFtCIEmgwi2-11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0;entryDx=0;entryDy=15;entryPerimeter=0;startArrow=classic;startFill=1;" edge="1" parent="1" source="HTI_eXZl_OFtCIEmgwi2-3" target="HTI_eXZl_OFtCIEmgwi2-10">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="HTI_eXZl_OFtCIEmgwi2-14" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0;exitDx=0;exitDy=15;exitPerimeter=0;entryX=1;entryY=0.75;entryDx=0;entryDy=0;startArrow=classicThin;startFill=1;" edge="1" parent="1" source="HTI_eXZl_OFtCIEmgwi2-12" target="HTI_eXZl_OFtCIEmgwi2-3">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="HTI_eXZl_OFtCIEmgwi2-12" value="Redis" style="shape=module;align=left;spacingLeft=20;align=center;verticalAlign=top;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="670" y="110" width="100" height="50" as="geometry" />
        </mxCell>
        <mxCell id="HTI_eXZl_OFtCIEmgwi2-13" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0;entryDx=0;entryDy=35;entryPerimeter=0;startArrow=classic;startFill=1;" edge="1" parent="1" source="HTI_eXZl_OFtCIEmgwi2-4" target="HTI_eXZl_OFtCIEmgwi2-12">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="HTI_eXZl_OFtCIEmgwi2-15" value="Group DB&lt;div&gt;PostgreSQL&lt;/div&gt;" style="shape=module;align=left;spacingLeft=20;align=center;verticalAlign=top;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="670" y="190" width="100" height="50" as="geometry" />
        </mxCell>
        <mxCell id="HTI_eXZl_OFtCIEmgwi2-16" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.75;exitDx=0;exitDy=0;entryX=0;entryY=0;entryDx=0;entryDy=15;entryPerimeter=0;startArrow=classic;startFill=1;" edge="1" parent="1" source="HTI_eXZl_OFtCIEmgwi2-4" target="HTI_eXZl_OFtCIEmgwi2-15">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="HTI_eXZl_OFtCIEmgwi2-17" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1.001;entryY=0.631;entryDx=0;entryDy=0;entryPerimeter=0;startArrow=classic;startFill=1;" edge="1" parent="1" source="HTI_eXZl_OFtCIEmgwi2-5" target="HTI_eXZl_OFtCIEmgwi2-2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="HTI_eXZl_OFtCIEmgwi2-18" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.996;entryY=0.868;entryDx=0;entryDy=0;entryPerimeter=0;startArrow=classic;startFill=1;" edge="1" parent="1" source="HTI_eXZl_OFtCIEmgwi2-6" target="HTI_eXZl_OFtCIEmgwi2-2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="HTI_eXZl_OFtCIEmgwi2-21" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0;exitDx=0;exitDy=35;exitPerimeter=0;entryX=1;entryY=0.25;entryDx=0;entryDy=0;" edge="1" parent="1" source="HTI_eXZl_OFtCIEmgwi2-19" target="HTI_eXZl_OFtCIEmgwi2-6">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="HTI_eXZl_OFtCIEmgwi2-19" value="Kafka" style="shape=module;align=left;spacingLeft=20;align=center;verticalAlign=top;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="670" y="270" width="100" height="50" as="geometry" />
        </mxCell>
        <mxCell id="HTI_eXZl_OFtCIEmgwi2-22" value="Cassandra" style="shape=module;align=left;spacingLeft=20;align=center;verticalAlign=top;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="670" y="360" width="100" height="50" as="geometry" />
        </mxCell>
        <mxCell id="HTI_eXZl_OFtCIEmgwi2-24" value="&lt;h1 style=&quot;margin-top: 0px;&quot;&gt;Redis&lt;/h1&gt;&lt;p&gt;Срвисы начала обращаются в Redis и если не находят данных, то идут в свои БД&lt;/p&gt;" style="text;html=1;whiteSpace=wrap;overflow=hidden;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="810" y="110" width="180" height="120" as="geometry" />
        </mxCell>
        <mxCell id="HTI_eXZl_OFtCIEmgwi2-25" value="&lt;h1 style=&quot;margin-top: 0px;&quot;&gt;Analytics Service&lt;/h1&gt;&lt;p&gt;Все события которыеслучаются в системе, а также в приложении и прочие сообщения, которые отправляются в аналитический сервис отправляются в Kafka.&amp;nbsp;&lt;/p&gt;&lt;p&gt;Сервис классифицирует пользователейпо интересам, ытается понять о чем говорят пользователи, если сообщения не зашифрованы И результаты отправляет либо в Kafka либо в Hadoop.&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;" style="text;html=1;whiteSpace=wrap;overflow=hidden;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="810" y="280" width="270" height="200" as="geometry" />
        </mxCell>
        <mxCell id="HTI_eXZl_OFtCIEmgwi2-26" value="&lt;h1 style=&quot;margin-top: 0px;&quot;&gt;Last Seen Service&lt;/h1&gt;&lt;p&gt;Использует Cassandra и хранит ID пользователя и время последней активности:&lt;/p&gt;&lt;p&gt;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;открыл\закрыл приложение&lt;/li&gt;&lt;li&gt;сделал что-то с контентом&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;/p&gt;&lt;p&gt;Если только это, то можно хранить и в Redis, но как правило есть еще дополнительная информация, поэтому лучше Casandra.&lt;/p&gt;" style="text;html=1;whiteSpace=wrap;overflow=hidden;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="470" y="450" width="300" height="170" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
